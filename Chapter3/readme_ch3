# GeneticDataAnalyzer: F2 Intercross Meiotic Interference Analysis Software

## Overview

**GeneticDataAnalyzer** is a comprehensive tool for analyzing meiotic interference in F₂ intercross populations using multilocus genotypic data. The software implements four hierarchical statistical models that enable quantitative assessment of crossover interference effects while accounting for sex-specific differences in recombination rates.

## Scientific Background

### Biological Context

Meiotic interference is the phenomenon whereby crossover formation in one chromosomal interval influences the probability of crossover occurrence in adjacent intervals. Interference is characterized by the **coefficient of coincidence** (COC, *c*), which relates observed and expected frequencies of double crossovers (DCO):

\[ c = \frac{O_{DCO}}{E_{DCO}} \]

where \(O_{DCO}\) represents observed frequency and \(E_{DCO}\) represents expected frequency of double crossovers.

**Interference** (*I*) is calculated as:

\[ I = 1 - c \]

- *I* > 0: positive interference — a crossover suppresses formation of adjacent crossovers
- *I* = 0: absence of interference
- *I* < 0: negative crossover interference (NCOI) — a crossover increases probability of adjacent crossovers

### Analysis Models

The software implements four nested models compared using maximum likelihood methods:

#### Model 1: Null Model
- No sex differences in recombination rates
- Coefficient of coincidence *c* = 1 (no interference)
- **Parameters:** r₁, r₂

#### Model 2: Free COC Model
- No sex differences in r₁ and r₂
- Coefficient of coincidence *c* as free parameter
- **Parameters:** r₁, r₂, *c*
- **Test:** LR-test Model 1 vs Model 2 (df = 1)

#### Model 3: Sex Differences with Equal COC
- Different recombination rates in two groups (group 1 and group 2)
- Single common coefficient of coincidence *c*₁ = *c*₂
- **Parameters:** r₁₁, r₂₁, r₁₂, r₂₂, *c*
- **Test:** LR-test Model 2 vs Model 3 (df = 3)

#### Model 4: Full Sex-Specific Model
- Different recombination rates in both groups
- Different coefficients of coincidence *c*₁ ≠ *c*₂
- **Parameters:** r₁₁, r₂₁, r₁₂, r₂₂, *c*₁, *c*₂
- **Test:** LR-test Model 3 vs Model 4 (df = 1)

### F₂ Genetic Model

The software utilizes a two-factor F₂ intercross model with three-point analysis. For each locus, three allelic states are possible:
- **A** — homozygous state (first type)
- **B** — homozygous state (second type)
- **H** — heterozygous state

A total of 27 genotypic classes are analyzed (n₁₁₁ ... n₃₃₃).

## Installation and Requirements

### Dependencies

```
python>=3.7
numpy>=1.19.0
pandas>=1.0.0
scipy>=1.5.0
openpyxl>=3.0.0
```

### Installation

```bash
pip install numpy pandas scipy openpyxl
```

## Structure and Usage

### Main Class: GeneticDataAnalyzer

```python
from analyzer import GeneticDataAnalyzer

# Initialize with minimum and maximum distance parameters (in cM)
analyzer = GeneticDataAnalyzer(min_distance=5.0, max_distance=25.0)

# Read genetic data
data = analyzer.read_genetic_data('path/to/genetic_data.txt')

# Perform interference analysis
results = analyzer.analyze_interference(data)
```

### Input Data Format

Input files must be in text format (.txt) with the following structure:

```
[position] [marker] [genotype_ind1] [genotype_ind2] ... [genotype_indN]
```

**Example:**
```
1.5    m1  A  B  H  A  B  H  A  ...
5.2    m2  B  B  A  B  H  A  B  ...
12.8   m3  H  A  A  H  B  B  A  ...
```

**Permitted designations:**
- **A, B** — homozygous alleles
- **H** — heterozygous state
- **-** (dash) — missing data

### Method: analyze_interference()

Primary method performing complete interference analysis:

```python
results = analyzer.analyze_interference(data)
```

**Returned Results (pd.DataFrame):**

| Column | Description | Type |
|--------|-------------|------|
| `start_position` | Position of first marker (cM) | float |
| `middle_position` | Position of middle marker (cM) | float |
| `end_position` | Position of third marker (cM) | float |
| `markers` | Names of three markers | str |
| `interval1_length` | Distance between first and second markers (cM) | float |
| `interval2_length` | Distance between second and third markers (cM) | float |
| `r1_group1` | Recombination rate interval 1, group 1 | float |
| `r2_group1` | Recombination rate interval 2, group 1 | float |
| `r1_group2` | Recombination rate interval 1, group 2 | float |
| `r2_group2` | Recombination rate interval 2, group 2 | float |
| `model1_ll` | Log-likelihood null model | float |
| `model2_ll` | Log-likelihood free COC model | float |
| `model3_ll` | Log-likelihood equal COC model | float |
| `model4_ll` | Log-likelihood differential COC model | float |
| `lr_1vs2` | LR statistic (Model 1 vs 2) | float |
| `lr_2vs3` | LR statistic (Model 2 vs 3) | float |
| `lr_3vs4` | LR statistic (Model 3 vs 4) | float |
| `p_1vs2` | P-value (Model 1 vs 2) | float |
| `p_2vs3` | P-value (Model 2 vs 3) | float |
| `p_3vs4` | P-value (Model 3 vs 4) | float |
| `c_null` | COC with c = 1 | float |
| `c_free` | Optimal COC (Model 2) | float |
| `c_equal` | Optimal COC, common to both groups (Model 3) | float |
| `c1_diff` | Optimal COC for group 1 (Model 4) | float |
| `c2_diff` | Optimal COC for group 2 (Model 4) | float |
| `valid_samples` | Number of valid individuals | int |
| `observed_freqs` | Dictionary of observed genotype frequencies | dict |

### Key Methods

#### find_marker_triplets(positions)
Identifies all valid marker triplets with distances in the range [min_distance, max_distance].

```python
triplets = analyzer.find_marker_triplets(positions)
# Returns: list of tuples (i, j, k) — marker indices
```

#### calculate_recombination_rates(observed_freqs)
Calculates recombination rates based on observed genotype frequencies.

```python
rates = analyzer.calculate_recombination_rates(observed_freqs)
# Returns: ((r1_group1, r2_group1), (r1_group2, r2_group2))
```

#### optimize_model(observed_freqs, initial_rates, model_type)
Optimizes parameters of selected model using Nelder-Mead method.

```python
model_result = analyzer.optimize_model(
    observed_freqs,
    initial_rates,
    model_type='diff_c'  # or 'null', 'free', 'equal_c'
)
```

## Complete Analysis Example

```python
import os
from analyzer import GeneticDataAnalyzer

# Initialize
analyzer = GeneticDataAnalyzer(min_distance=5.0, max_distance=25.0)

# Process all files in directory
directory = '/path/to/data'
all_results = []

for filename in os.listdir(directory):
    if filename.endswith('.txt'):
        file_path = os.path.join(directory, filename)
        
        # Read data
        data = analyzer.read_genetic_data(file_path)
        print(f"Processing {filename}: {data.shape[0]} markers")
        
        # Analyze interference
        results = analyzer.analyze_interference(data)
        
        if not results.empty:
            results['source_file'] = filename
            all_results.append(results)
            print(f"Found {len(results)} marker triplets")

# Combine results
combined = pd.concat(all_results, ignore_index=True)

# Save to Excel
combined.to_excel('results.xlsx', index=False)
print(f"Total processed: {len(combined)} triplets")
```

## Results Interpretation

### Model Adequacy Testing

1. **Model 1 vs Model 2 (LR_1vs2, p-value p_1vs2)**
   - If p < 0.05: reject hypothesis of no interference
   - Conclusion: significant interference detected

2. **Model 2 vs Model 3 (LR_2vs3, p-value p_2vs3)**
   - If p < 0.05: sex differences in recombination are significant
   - Conclusion: sex differentiation must be accounted for

3. **Model 3 vs Model 4 (LR_3vs4, p-value p_3vs4)**
   - If p < 0.05: coefficients of coincidence differ between groups
   - Conclusion: interference exhibits sex-specific patterns

### Interpretation of COC Values

- **c < 0.5**: negative interference (NCOI) — crossover increases probability of adjacent crossovers
- **c ≈ 0.5**: intermediate interference
- **c > 0.5**: positive interference — crossover suppresses adjacent crossovers
- **c = 1.0**: absence of interference

### Interpretation Example

```
Interval: 5.2 - 12.8 - 21.5 cM
Interval lengths: 7.6, 8.7 cM
Markers: m2 - m3 - m5

Test Model 1 vs 2:
  LR = 8.42, p = 0.0037 ✓ (reject hypothesis of no interference)

Test Model 2 vs 3:
  LR = 6.15, p = 0.1045 (sex differences not significant)

Result: Significant interference (c = 0.32) without sex differences
```

## Statistical Methods

### Maximum Likelihood

Parameter optimization is performed by minimizing negative log-likelihood:

\[ -LL = -\sum_{i} n_i \log(p_i) \]

where \(n_i\) are observed frequencies and \(p_i\) are theoretical genotype frequencies.

### LR Tests

All inter-model comparisons utilize likelihood ratio tests:

\[ LR = 2(LL_{\text{full}} - LL_{\text{restricted}}) \]

The LR statistic follows a χ² distribution with degrees of freedom equal to the difference in number of parameters between models.

### Optimization Algorithm

Nelder-Mead simplex method is employed with convergence criteria:
- **xatol**: parameter tolerance (1e-8)
- **fatol**: function tolerance (1e-8)
- **maxiter**: maximum iterations (200)

Optimization is performed from multiple starting points to avoid local minima.

## Data Validation

The software automatically filters:
- Marker triplets with intervals outside [min_distance, max_distance] range
- Individuals with missing genotypic data (designated as '-')
- Samples with < 30 valid individuals (default threshold)

## Implementation Features

### Genotypic Data Processing

1. **Input file parsing**: automatic removal of service characters ('T', spaces, single 'S')
2. **Data alignment**: gap filling with '-' values
3. **Validation**: verification of genotype compliance with permitted set

### Computational Efficiency

- NumPy and Pandas for vectorized operations
- Caching of theoretical frequency calculations
- Parallelizable processing of multiple triplets

## Output Data

### Results Format

Results are saved in Excel format (.xlsx) with complete information for each marker triplet, including:
- Positions and names of markers
- Distances between markers
- Recombination rates for each group
- Optimization parameters for all four models
- LR statistics and p-values for hierarchical tests
- Observed genotype frequencies

### Timestamp

Each results file is automatically timestamped in YYYYMMDD_HHMMSS format for version tracking.

## Limitations and Recommendations

1. **Sample size**: minimum 30 valid individuals per triplet for reliable estimates
2. **Marker distances**: recommended range 5-25 cM
3. **Data completeness**: missing data should not exceed 20%
4. **Independence**: only independent marker triplets are analyzed

## Citation

When using this software in publications, please cite:

Sapielkin S. et al. (2025) "Extended Gamma-Sprinkled Model for Crossover Interference: Sex-specific Analysis and Temporal Dynamics" *BMC Genomics*, in revision.

## Author

**Shaul Sapielkin**
Department of Genetics and Cytology, Lomonosov Moscow State University

## License

MIT License

## Contact and Support

For questions or bug reports, please contact the author.

---

**Version**: 1.0  
**Last Updated**: November 2025  
**Programming Language**: Python 3.7+
